Title: 函数式领域建模(五)
Author: HanXiao
Date: 2019-12-10 15:00
Tags: 函数式, 领域驱动, DDD

[TOC]

现在, 我们构建了一组丰富的领域模型. 接下来要做的是 "[保护好](http://www.smallcpp.cn/han-shu-shi-ling-yu-jian-mo-er.html#trust-boundaries-and-validation)" 它, 因此应该采取一些预防措施, 以确保此域中的任何数据都是有效和一致的. 我们的目标是创建一个边界上下文, 该上下文始终包含我们可以信任的数据, 与不受信任的外部世界不同. 如果我们能够确保所有数据始终有效, 则实现可以保持干净, 并且我们可以避免执行防御性编程.

先来看下两个很重要的概念, [上一节](http://www.smallcpp.cn/han-shu-shi-ling-yu-jian-mo-si.html#aggregates-enforce-consistency-and-invariants)中也有提到.

- **Integrity** (or validity) 意味着一段数据遵循正确的业务规则.
- **Consistency** 意味着领域模型的不同部分要与事实一致.

> **Invariants** are generally business rules/enforcements/requirements that you impose to maintain the **integrity** of an object at any given time.

在我们的例子中:

- Integrity
  - UnitQuantity 介于 1 和 1000 之间.
  - Order 必须始终至少有一个 OrderLine.
  - Order 在发送到运输部门之前必须具有经过验证的运输地址.
- Consistency
  - Order 的帐单总金额应为 OrderLines 的总和. 如果金额不等, 则数据不一致.
  - 下订单后, 必须创建相应的发票. 如果订单存在, 但发票不存在, 则数据不一致.
  - 如果折扣凭证代码与订单一起使用, 则必须将凭证代码标记为已使用, 以便无法再次使用. 如果订单引用该凭证, 但凭证未标记为已使用, 则数据不一致.

# Integrity of Simple Values
