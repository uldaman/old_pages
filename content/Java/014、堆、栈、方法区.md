Title: 014、堆、栈、方法区
Author: Martin
Date: 2016-03-03 18:00
Summary: 关于堆栈的知识, 其实在之前做逆向的时候, 已经弄的比较清楚了, Java 中的堆栈也是大同小异, 不过还是整理一下吧.

##1. 基本概念
JAVA的JVM的内存可分为3个区: 堆(heap)、栈(stack)和方法区(method).

堆区:

1. 存储的全部是对象, 如类的实例、数组等.
2. jvm 只有一个堆区(heap)被所有线程共享, 堆中不存放基本类型和对象引用, 只存放对象本身.

栈区:

1. 每个线程包含一个栈区, 栈中只保存基础数据类型的对象和自定义对象的引用(不是对象), 对象都存放在堆区中.
2. 每个栈中的数据(原始类型和对象引用)都是私有的, 其他栈不能访问.
3. 栈分为3个部分: 基本类型变量区、执行环境上下文、操作指令区(存放操作指令).

方法区:

1. 又叫静态区, 跟堆一样, 被所有的线程共享, 方法区包含所有的 **class 信息**、**static 变量**以及**方法主体**.
2. 方法区中包含的都是在整个程序中永远唯一的元素, 如class 信息、 static变量以及方法主体.

##2. 堆栈溢出
当我们启动一个 Java 进程时, 栈内存默认是 **1 m**, 而堆内存默认是物理机的 **1/4**.

如果当我们大量调用方法时, 如递归调用方法, 那就可能导致栈溢出;<br>而当我们生成大量的对象时, 就有可能导致堆溢出.

所以 Java 也提供了一些参数来调用设置 JVM 的堆栈大小:

- java -x =\> 查看所有的扩展参数
- java -Xmx =\> 设置 jvm 最大可用堆大小
- java -Xms =\>设置 jvm 初始堆大小
- java -Xss =\>设置 jvm 栈大小

***

补充一些 java 工具:

**jps** 查看所有 java 程序.

**jmap** 查看 java 进程的一些信息.

- **jamp -heap pid** 查看进程堆信息.
