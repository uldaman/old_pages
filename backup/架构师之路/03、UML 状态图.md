Title: 03、UML 状态图
Author: Martin
Date: 2016-04-01 20:17
Summary: 状态图是一种"开关", 描述的是状态变化的图形.

[TOC]

# 概述
状态图是一种"开关", 描述的是__状态变化__的图形, 即__一个__对象__状态__与__状态的转变__, 并且给出了状态变化的__起点__和__终点__, 类比__流程图__.

> __使用场景__<br>
> 需要描述一个对象的状态跟踪的时候, 比如一个表单在不同环节审批的状态

在 StarUML 中新建状态图:<br>
打开 StarUML, 选择 __Rational Approach__.<br>
<<__Logical View__\>\> \-\-\> Add Diagram \-\-\> Statechart Diagram<br>
界面左边就出现了 Statechart 工具栏.

|     StarUML     |             翻译             |
|-----------------|------------------------------|
| State           | 状态节点                     |
| SubmachineState | 状态子节点                   |
| InitialState    | 初始状态                     |
| FinalState      | 结束状态                     |
| JunctionPoint   | 交汇点(两条状态传递线交汇处) |
| ChoicePoint     | 选择点(又叫进入节点)         |
| ShallowHistory  | 浅层历史状态                 |
| DeepHistory     | 深层历史状态                 |
| Synchronization | 同步                         |
| Flow Final      | 对象流程结束(退出节点)       |
| Transition      | 状态传递                     |
| SelfTransition  | 自我状态传递                 |

# 核心要素
对于状态图来说, 最为__核心__的元素无外乎是两个:

- 一个是用圆角矩形表示的状态(State)
- 一个则是在状态之间的、包含一些文字描述的有向箭头线(Transition), 这些箭头线称为状态传递

![](http://i63.tinypic.com/29z3ifl.jpg)

![](http://i67.tinypic.com/2rcy7v6.jpg)

- 源状态: 即受转换影响的状态
- 目标状态: 当转换完成后对象的状态
- 触发事件: 用来为转换定义一个事件, 包括调用、改变、信号、时间四类事件
- 监护条件: 布尔表达式, 决定是否激活转换
- 动作: 转换激活时的操作

# 状态动作
__状态节点有三个内部动作__:

- EntryActiors, 进入状态时触发的动作
- DoActions, 状态中执行的动作
- ExitActions, 退出状态时触发的动作

当然, 这三个事件都不是必须的, 根据需求来填写.<br>
例如在上例中, 对象状态转移后的动作(__烧水__), 是显示在箭头线上, 也可以定义__进入动作__(EntryActions)来描述转换激活时的操作

![](http://i64.tinypic.com/fuuwb4.jpg)

# 复合状态
另外, 在某些时候, 还可以使用__复合状态__, 它表示在某一状态中, 还维护着其它的状态.<br>
如, 在电脑运行的时候, 还会维护一个待机的状态.

![](http://i68.tinypic.com/34qmj9v.jpg)

# 退出/进入节点
上面的图中, 除了用到了__复合状态__外, 还使用了__退出节点__(Flow Final), 它表示状态可以有多个退出事件, 如__上图__中的 *长按电源键* 或者 *断电*, 都会触发 running 状态的退出.

除了__退出节点__(Flow Final)外, 还有个 __ChoicePoint__(选择节点, 又叫进入节点), 它表示一个状态有多个进入事件, 就不放图举例了.

# 子节点
再来看看 __SubmachineState__(状态子节点), 它所以表示的是该状态是另一个状态(称之为母状态)的子状态, 母状态中以__引用__的方式把一个已经存在的状态作为自己子状态, 在母状态机中子机状态作为一个子状态, 但它自身仍是一个__完整的状态__.

![](http://i65.tinypic.com/14tylx3.jpg)

# 历史状态
__ShallowHistory__(历史状态), 为一个状态提供了一种在退出状态时记忆当前活动所处的子状态, 并能够返回到该子状态的机制.<br>
例如下图, 当发生暂停时, 记住播放状态, 当继续播放时就直接进入播放状态.

![](http://i63.tinypic.com/15wjlmh.jpg)

> StarUML 中有 __ShallowHistory__ 和 __DeepHistory__, 但在大多情况下是随便用哪个, 并没有做太多要求, 只要表达清楚这里是一个"历史"就可以了.

# 同步
__Synchronization__ 又分两种, 分叉与汇合.

- 分叉: 指将一个转换分成两个或多个转换, 用来描述需要__并发__的状态
- 汇合: 指将从并发状态来的转换合并形成一个转换, 用来描述多个并发状态的控制__同步__

![](http://i68.tinypic.com/2aafsxy.jpg)
